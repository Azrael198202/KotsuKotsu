# AGENTS.md
# 小学数学做题 iPad App 开发文档（无后台·离线题库版）

## 一、项目定位

### 目标

开发一款 **iPad 小学数学练习 App（1~6年级）**

特点：

* 完全离线运行
* 无账号系统
* 无后台
* 无班级管理
* 题库内置在 App 中
* 学生直接做题
* 做题记录保存在本机
* 作业有分数与时间要求

适用于：

> 学校课堂练习
> 家庭练习
> 平板教学设备

---

## 二、系统总体结构

```
iPad App
 ├── 年级选择
 ├── 作业类型选择
 ├── 做题界面
 ├── 作业结果判定
 ├── 本地题库（assets）
 └── 本地做题记录（数据库）
```

全部运行在本地。

---

## 三、题库设计（核心）

### 题库存放方式

题库在开发阶段由老师制作
放入项目 assets 目录
随 App 一起编译

```
assets/question_bank/
```

---

### 目录结构（按年级+作业类型）

```
assets/question_bank/
  g1/
    add_sub.txt
    word.txt

  g2/
    add_sub.txt
    mul_basic.txt
    div_basic.txt
    word.txt

  g3/
    add_sub_column.txt
    mul_column.txt
    div_column.txt
    word.txt

  g4/
    mul_column.txt
    div_long.txt
    word.txt

  g5/
    decimals.txt
    div_long.txt
    word.txt

  g6/
    fractions.txt
    ratio.txt
    word.txt
```

---

## 四、题库文件格式（极简）

### 基本规则

每个 txt 文件：

> 每行一题
> 不需要写答案
> 系统自动计算

---

### 示例1：加减

`g2/add_sub.txt`

```
34+28
72-39
18+7=
45+19
```

支持是否写等号：

```
2+4
2+4=
```

系统统一生成填空题：

```
2+4 = [   ]
```

---

### 示例2：乘法

`g3/mul_column.txt`

```
34×12
25×14
126×3
```

支持：

```
× 或 *
```

---

### 示例3：除法竖式（重点）

`g4/div_long.txt`

```
156÷12
1765÷20
980÷14
728÷7
```

系统自动生成：

* 商
* 余数
* 竖式步骤
* 学生逐步填写UI

---

### 示例4：小数

`g5/decimals.txt`

```
3.5+2.7
12.6÷3
2.5×1.2
```

---

### 示例5：分数

`g6/fractions.txt`

```
1/2+1/3
7/8-1/4
2/3×3/4
5/6÷2/3
```

---

### 示例6：应用题

使用前缀 `[WORD]`

`word.txt`

```
[WORD] 小明有12个苹果，又买8个，一共有多少个？
[WORD] 36个糖分给9个同学，每人多少个？
```

---

## 五、题型识别规则（自动）

系统读取每一行后自动识别：

| 内容       | 题型  |
| -------- | --- |
| 含 + -    | 加减  |
| 含 × *    | 乘法  |
| 含 ÷ /    | 除法  |
| 含 .      | 小数  |
| 含 a/b    | 分数  |
| [WORD]开头 | 应用题 |

---

## 六、UI题型组件

系统只需要做 6 个 UI 组件：

### 1️⃣ 普通填空题

```
23+45 = [   ]
```

用于：

* 加减
* 小数
* 基础乘除

---

### 2️⃣ 竖式加减

```
 345
+278
-----
[   ]
```

---

### 3️⃣ 竖式乘法

```
  34
× 12
------
```

---

### 4️⃣ 竖式除法（核心）

系统自动生成步骤：

```
20 ) 1765
-160
-----
165
-160
-----
[ ]
```

学生逐步输入。

---

### 5️⃣ 分数输入UI

```
1/2 + 1/3 = [   ]
```

或

```
□/□
```

---

### 6️⃣ 应用题UI

```
题目
答案：[     ]
```

---

## 七、做题记录保存（本地）

全部保存在 iPad 本机：

建议使用：

* SQLite
  或
* Isar

保存内容：

```
题目ID
是否做过
正确次数
错误次数
最后作答时间
每次作业得分
每次作业用时
是否通过
```

---

## 八、作业计时与通过机制（新增）

老师在“年级 + 作业类型”中配置：

* 作业分数要求
* 作业时间要求

做题时：

* 开始即计时
* 提交后自动批改

判定规则：

* 同时满足“分数要求 + 时间要求”才算通过
* 未通过则重复做同一套题，直到通过为止

本地数据库记录：

* 每次作业得分
* 每次作业用时
* 是否通过

---

## 九、错误题记录（保留，不做错题本）

自动记录：

* 做错的题
* 用于后续汇总总结
* 不需要“错题本”界面
* 不需要强制重做错题

---

## 十、题库追加方式

### 开发期追加

老师新增题目：

```
在txt文件末尾追加
```

重新编译App即可。

### 或新增文件

```
div_long_02.txt
```

系统自动合并读取。

---

## 十一、关键开发模块

### 1️⃣ 题库读取模块

读取：

```
assets/question_bank/
```

解析所有txt。

---

### 2️⃣ 解析器模块

负责：

* 去空格
* 识别符号
* 自动算答案
* 生成题型

---

### 3️⃣ 竖式除法生成器（重要）

输入：

```
1765÷20
```

输出：

```
商=88
余数=5
steps=[...]
```

用于黑板UI渲染。

---

### 4️⃣ UI渲染引擎

根据题型自动选择组件：

| type       | UI   |
| ---------- | ---- |
| add_sub    | 填空   |
| mul_column | 乘法竖式 |
| div_long   | 除法黑板 |
| fractions  | 分数UI |
| word       | 应用题  |

---

## 十二、开发优先顺序（重要）

### 第1阶段（必须先做）

* 题库读取
* 普通填空UI
* 竖式除法UI ⭐
* 本地保存
* 作业计时与通过判定
* 作业得分/用时记录
* 乘法竖式
* 加减竖式
* 覆盖1~6年级常见算术题型

#### 常见算式类别与对应UI（1~6年级）

* 加减（口算/整数/小数）→ 普通填空UI
* 乘除（口算/整数/小数）→ 普通填空UI
* 竖式加减 → 竖式加减UI
* 竖式乘法 → 竖式乘法UI
* 竖式除法（含余数）→ 竖式除法UI
* 分数四则 → 分数输入UI
* 应用题 → 应用题UI

#### 按年级细分题型（参考）

* 1年级：加减口算、简单应用题
* 2年级：加减进退位、乘法口诀入门、除法基础、应用题
* 3年级：竖式加减、竖式乘法、竖式除法基础、应用题
* 4年级：大数四则、竖式除法（多步）、应用题
* 5年级：小数四则、竖式除法（含小数）、应用题
* 6年级：分数四则、比与比例、应用题

#### 文件名识别题型与UI生成（新增）

系统以“老师上传的文件名 + 文件内容”双重判断题型：

* 文件名优先级更高，用于快速定位题型
* 若文件名无法识别，再降级用内容规则判断

文件名到题型的推荐映射：

* `add_sub` / `add` / `sub` → 加减（普通填空UI）
* `mul` / `multiply` → 乘法（普通填空UI）
* `div` / `divide` → 除法（普通填空UI）
* `add_sub_column` → 竖式加减UI
* `mul_column` → 竖式乘法UI
* `div_long` / `div_column` → 竖式除法UI
* `decimals` → 小数四则（普通填空UI）
* `fractions` → 分数四则（分数输入UI）
* `word` → 应用题UI

内容规则（文件名无法识别时）：

* 含 `+` 或 `-` → 加减
* 含 `×` 或 `*` → 乘法
* 含 `÷` 或 `/` → 除法
* 含 `.` → 小数
* 含 `a/b` → 分数
* 以 `[WORD]` 开头 → 应用题

文件命名规范示例：

* `g1/add_sub.txt`
* `g2/add_sub_column.txt`
* `g3/mul_column.txt`
* `g4/div_long.txt`
* `g5/decimals.txt`
* `g6/fractions.txt`
* `g3/word.txt`
* `g4/div_long_02.txt`

题型优先级冲突处理规则：

* 优先使用“文件名识别结果”
* 文件名无法识别时，使用“内容规则”
* 若文件名与内容规则冲突，以“文件名”为准
* 若同一题同时包含多个符号，按以下顺序判定：
  * `[WORD]` > 分数 > 小数 > 除法 > 乘法 > 加减
* 若内容规则无法判定，标记为“unknown”，记录日志并跳过该题

### 第2阶段

* 用户注册登录
* 收费试用
* 总结汇总（基于错误题记录）

### 第3阶段

* 分数
* 小数
* 应用题

---

## 十三、技术建议

### 推荐框架

Flutter（iPad最佳）

### 数据库存储

Isar 或 SQLite

### 架构

完全离线
不需要服务器

---

## 十四、最终产品形态

学生打开：

```
选择年级
→选择作业类型
→开始做题
→提交判定是否通过
```

全部离线运行。

---

## 结束

这是完整的：

> ⭐ 学校级
> ⭐ 离线
> ⭐ iPad
> ⭐ 数学做题系统开发文档
